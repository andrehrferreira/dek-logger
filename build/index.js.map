{"version":3,"sources":["../src/index.js"],"names":["BugsnagTransport","opts","silent","level","Bugsnag","start","apiKey","process","env","LOGGER_BUGSNAG_API_KEY","plugins","BugsnagPluginExpress","info","callback","setImmediate","emit","Error","notify","message","Transport","logger","winston","createLogger","format","json","NODE_ENV","add","transports","Console","simple","consoleWarnLevels","Object","prototype","hasOwnProperty","call","$","set","getPlugin","e","console","log"],"mappings":";;;;;;;AAAA;;AACA;;AACA;;AACA;;AACA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;IAEMA,gB;;;;;AACF,4BAAYC,IAAZ,EAAkB;AAAA;;AAAA;;AACd,8BAAMA,IAAN;AAEA,UAAKC,MAAL,GAAcD,IAAI,IAAIA,IAAI,CAACC,MAAb,IAAuB,KAArC;AACA,UAAKC,KAAL,GAAaF,IAAI,IAAIA,IAAI,CAACE,KAAb,IAAsB,OAAnC;;AAEAC,mBAAQC,KAAR,CAAc;AACVC,MAAAA,MAAM,EAAEC,OAAO,CAACC,GAAR,CAAYC,sBADV;AAEVC,MAAAA,OAAO,EAAE,CAACC,yBAAD;AAFC,KAAd;;AANc;AAUjB;;;;wBAEIC,I,EAAMC,Q,EAAU;AAAA;;AAEjBC,MAAAA,YAAY,CAAC;AAAA,eAAM,MAAI,CAACC,IAAL,CAAU,QAAV,EAAoBH,IAApB,CAAN;AAAA,OAAD,CAAZ;;AAEA,UAAI,KAAKV,MAAT,EAAiB;AACb,YAAI,OAAOW,QAAP,IAAmB,UAAvB,EAAmC,OAAOA,QAAQ,EAAf;AACnC;AACH;;AAED,UAAGD,IAAI,YAAYI,KAAnB,EACIZ,eAAQa,MAAR,CAAeL,IAAf,EADJ,KAEK,IAAG,OAAOA,IAAI,CAACM,OAAZ,IAAuB,QAA1B,EACDd,eAAQa,MAAR,CAAe,IAAID,KAAJ,CAAUJ,IAAI,CAACM,OAAf,CAAf;AAEJ,UAAI,OAAOL,QAAP,IAAmB,UAAvB,EAAmC,OAAOA,QAAQ,EAAf;AAEnC;AACH;;;;EA9B0BM,4B;;oFAiChB;AAAA;;AAAA;AAAA;AAAA;AAAA;AACX,cAAI;AACIC,YAAAA,MADJ,GACaA,MAAM,GAAGC,oBAAQC,YAAR,CAAqB;AACvCnB,cAAAA,KAAK,EAAE,MADgC;AAEvCoB,cAAAA,MAAM,EAAEF,oBAAQE,MAAR,CAAeC,IAAf;AAF+B,aAArB,CADtB;;AAKA,gBAAIjB,OAAO,CAACC,GAAR,CAAYiB,QAAZ,IAAwB,YAA5B,EAA0C;AACtCL,cAAAA,MAAM,CAACM,GAAP,CAAW,IAAIL,oBAAQM,UAAR,CAAmBC,OAAvB,CAA+B;AACtCL,gBAAAA,MAAM,EAAEF,oBAAQE,MAAR,CAAeM,MAAf,EAD8B;AAEtCC,gBAAAA,iBAAiB,EAAE,CAAC,MAAD,EAAS,MAAT,EAAiB,OAAjB;AAFmB,eAA/B,CAAX;AAIH,aALD,MAMK;AACDV,cAAAA,MAAM,CAACM,GAAP,CAAW,IAAIL,oBAAQM,UAAR,CAAmBC,OAAvB,CAA+B;AACtCL,gBAAAA,MAAM,EAAEF,oBAAQE,MAAR,CAAeM,MAAf,EAD8B;AAEtC1B,gBAAAA,KAAK,EAAE;AAF+B,eAA/B,CAAX;AAIH;;AACD,gBAAI,CAAC4B,MAAM,CAACC,SAAP,CAAiBC,cAAjB,CAAgCC,IAAhC,CAAqC3B,OAAO,CAACC,GAA7C,EAAkD,wBAAlD,CAAL,EAAkF,CAC9E;;AACA;;;AAGH,aALD,MAKO;AACGY,cAAAA,OADH,GACYC,oBAAQC,YAAR,CAAqB;AAChCnB,gBAAAA,KAAK,EAAE,MADyB;AAEhCoB,gBAAAA,MAAM,EAAEF,oBAAQE,MAAR,CAAeC,IAAf,EAFwB;AAGhCG,gBAAAA,UAAU,EAAE,CACR,IAAI3B,gBAAJ,CAAqB;AAAEG,kBAAAA,KAAK,EAAE;AAAT,iBAArB,CADQ;AAHoB,eAArB,CADZ;;AASH,kBAAII,OAAO,CAACC,GAAR,CAAYiB,QAAZ,KAAyB,YAA7B,EAA2C;AACvCL,gBAAAA,OAAM,CAACM,GAAP,CAAW,IAAIL,oBAAQM,UAAR,CAAmBC,OAAvB,CAA+B;AACtCL,kBAAAA,MAAM,EAAEF,oBAAQE,MAAR,CAAeM,MAAf;AAD8B,iBAA/B,CAAX;AAGH;;AACDM,uBAAEC,GAAF,CACI,QADJ,EAEIhB,OAFJ;;AAKAe,uBAAEC,GAAF,CAAM,gBAAN,EACIhC,eAAQiC,SAAR,CAAkB,SAAlB,CADJ;AAGH;;AACDF,qBAAEC,GAAF,CACI,QADJ,EAEIhB,MAFJ;AAIH,WAjDD,CAiDE,OAAOkB,CAAP,EAAU;AACR;AACAC,YAAAA,OAAO,CAACC,GAAR,wBAA4BF,CAAC,CAACpB,OAA9B;AACH;;AArDU;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,C","sourcesContent":["import winston from \"winston\";\r\nimport Bugsnag from \"@bugsnag/js\";\r\nimport Transport from \"winston-transport\";\r\nimport BugsnagPluginExpress from \"@bugsnag/plugin-express\";\r\nimport { $ } from \"@dekproject/scope\";\r\n\r\nclass BugsnagTransport extends Transport {\r\n    constructor(opts) {\r\n        super(opts);\r\n\r\n        this.silent = opts && opts.silent || false;\r\n        this.level = opts && opts.level || \"silly\";\r\n\r\n        Bugsnag.start({\r\n            apiKey: process.env.LOGGER_BUGSNAG_API_KEY,\r\n            plugins: [BugsnagPluginExpress]\r\n        });\r\n    }\r\n    \r\n    log (info, callback) {\r\n\r\n        setImmediate(() => this.emit(\"logged\", info));\r\n\r\n        if (this.silent) {\r\n            if (typeof callback == \"function\") return callback();\r\n            return;\r\n        }\r\n\r\n        if(info instanceof Error) \r\n            Bugsnag.notify(info);\r\n        else if(typeof info.message == \"string\") \r\n            Bugsnag.notify(new Error(info.message));\r\n        \r\n        if (typeof callback == \"function\") return callback();\r\n\r\n        return;\r\n    }\r\n}\r\n\r\nexport default async () => {\r\n    try {\r\n        let logger = logger = winston.createLogger({\r\n            level: \"info\",\r\n            format: winston.format.json()\r\n        });\r\n        if (process.env.NODE_ENV == \"production\") {\r\n            logger.add(new winston.transports.Console({\r\n                format: winston.format.simple(),\r\n                consoleWarnLevels: [\"warn\", \"info\", \"error\"]\r\n            }));\r\n        }\r\n        else {\r\n            logger.add(new winston.transports.Console({\r\n                format: winston.format.simple(),\r\n                level: \"debug\"\r\n            }));\r\n        }\r\n        if (!Object.prototype.hasOwnProperty.call(process.env, \"LOGGER_BUGSNAG_API_KEY\")) {\r\n            // eslint-disable-next-line no-console\r\n            /*console.log(\r\n                \"[ LOGGER ] - There is no LOGGER_BUGSNAG_API_KEY variable in the .env file.\"\r\n            );*/\r\n        } else {\r\n            const logger = winston.createLogger({\r\n                level: \"info\",\r\n                format: winston.format.json(),\r\n                transports: [\r\n                    new BugsnagTransport({ level: \"error\" })\r\n                ]\r\n            });\r\n         \r\n            if (process.env.NODE_ENV !== \"production\") {\r\n                logger.add(new winston.transports.Console({\r\n                    format: winston.format.simple()\r\n                }));\r\n            }\r\n            $.set(\r\n                \"logger\",\r\n                logger\r\n            );\r\n\r\n            $.set(\"bugsnagexpress\",\r\n                Bugsnag.getPlugin(\"express\")\r\n            );\r\n        }\r\n        $.set(\r\n            \"logger\",\r\n            logger\r\n        );\r\n    } catch (e) {\r\n        // eslint-disable-next-line no-console\r\n        console.log(`[ Logger ] - ${e.message}`);\r\n    }\r\n};\r\n"],"file":"index.js"}