{"version":3,"sources":["../src/index.js"],"names":["BugsnagTransport","opts","silent","level","Bugsnag","start","apiKey","process","env","LOGGER_BUGSNAG_API_KEY","plugins","BugsnagPluginExpress","info","callback","setImmediate","emit","Error","notify","message","Transport","Object","prototype","hasOwnProperty","call","console","log","logger","winston","createLogger","format","json","transports","NODE_ENV","add","Console","simple","consoleWarnLevels","$","set","getPlugin","e"],"mappings":"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","sourcesContent":["import winston from \"winston\";\nimport Bugsnag from \"@bugsnag/js\";\nimport Transport from \"winston-transport\";\nimport BugsnagPluginExpress from \"@bugsnag/plugin-express\";\nimport { $ } from \"@dekproject/scope\";\nclass BugsnagTransport extends Transport {\n    constructor(opts) {\n        super(opts);\n        this.silent = opts && opts.silent || false;\n        this.level = opts && opts.level || \"silly\";\n        Bugsnag.start({\n            apiKey: process.env.LOGGER_BUGSNAG_API_KEY,\n            plugins: [BugsnagPluginExpress]\n        });\n    }\n    log (info, callback) {\n        setImmediate(() => this.emit(\"logged\", info));\n        if (this.silent) {\n            if (typeof callback == \"function\") return callback();\n            return;\n        }\n        if(info instanceof Error) {\n            Bugsnag.notify(info);\n        } else if(typeof info.message == \"string\") {\n            Bugsnag.notify(new Error(info.message));\n        }\n        if (typeof callback == \"function\") return callback();\n        return;\n    }\n}\n\nexport default async () => {\n    try {\n        if (\n            !Object.prototype.hasOwnProperty.call(\n                process.env,\n                \"LOGGER_BUGSNAG_API_KEY\"\n            )\n        ) {\n            // eslint-disable-next-line no-console\n            console.log(\n                \"[ LOGGER ] - There is no LOGGER_BUGSNAG_API_KEY variable in the .env file.\"\n            );\n        } else {\n            const logger = winston.createLogger({\n                level: \"info\",\n                format: winston.format.json(),\n                transports: [\n                    new BugsnagTransport({ level: \"error\" })\n                ]\n            });\n\n\n            if (process.env.NODE_ENV == \"production\") {\n                logger.add(new winston.transports.Console({\n                    format: winston.format.simple(),\n                    consoleWarnLevels: [\"warn\", \"info\", \"error\"]\n                }));\n            } \n            else {\n                logger.add(new winston.transports.Console({\n                    format: winston.format.simple(),\n                    level: \"debug\"\n                }));\n            }\n            $.set(\n                \"logger\",\n                logger\n            );\n\n            $.set(\"bugsnagexpress\",\n                Bugsnag.getPlugin(\"express\")\n            );\n        }\n    } catch (e) {\n        // eslint-disable-next-line no-console\n        console.log(`[ Logger ] - ${e.message}`);\n    }\n};\n"],"file":"index.js"}